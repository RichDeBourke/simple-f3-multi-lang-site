    <section id="content" role="main" class="detail-first-section bg-white">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <h1>Site details</h1>
                    <p>Things that make the site better:</p>
                    <ul>
                        <li><a class="same-page-link" href="#sitemap">Sitemap generation</a></li>
                        <li><a class="same-page-link" href="#fonts">Fonts</a></li>
                        <li><a class="same-page-link" href="#social">Social networking support</a></li>
                        <li><a class="same-page-link" href="#scroll-anchor">Scroll to anchor</a></li>
                        <li><a class="same-page-link" href="#scroll-button">Scroll-to-top button</a></li>
                        <li><a class="same-page-link" href="#reduced-motion">Prefers reduced motion</a></li>
                        <li><a class="same-page-link" href="#dark-mode">Dark mode</a></li>
                        <li><a class="same-page-link" href="#overlay-image-slider">Overlay image slider</a></li>
                        <li><a class="same-page-link" href="#image-management">Image management</a></li>
                        <li><a class="same-page-link" href="#fixed-hero">Fixed hero image</a></li>
                        <li><a class="same-page-link" href="#user-tracking">Privacy, IP addresses, and Google analytics</a></li>
                        <li><a class="same-page-link" href="#error-pages">Error response pages</a></li>
                        <li><a class="same-page-link" href="#highlighter">Syntax highlighter</a></li>
                        <li><a class="same-page-link" href="#language-flags">Language flags</a></li>
                        <li><a class="same-page-link" href="#firefox">Firefox flashs of unstyled content</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </section>

    <section id="sitemap" class="bg-white">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <h2>Sitemap</h2>
                    <p>The sitemap is generated dynamically by Fat-Free Framework and includes xhtml:links for alternate language information.</p>
                    <p>Including the xhtml:link in the sitemap causes some browsers to think the page is <em>not</em> an <a href="https://productforums.google.com/forum/#!topic/webmasters/SHgWtOpH-Ow" title="Google forum discussion on xhtml links">xml document</a>. That results in displaying the sitemap as html, similar to:</p>
                    <p class="mx-4 px-1" style="font-family: serif; border:1px solid #888888;">http://sbf-testing.byethost7.com/en/ 2018-06-15 http://sbf-testing.byethost7.com/en/<wbr>bootstrap 2018-06-15 http://sbf-testing.byethost7.com/en/<wbr>fatfree 2018-06-15</p>
                    <p>While the sitemap does validate (on Google), to make the information more readable, I added an XSL stylesheet based on one from <a href="https://github.com/pedroborges/xml-sitemap-stylesheet" title="XML sitemap stylesheet by Pedro Borges">GitHub</a>.</p>
                    <!-- The stylesheet is provided under an MIT license - the license is referenced in the style sheet -->
                    <p>I include alternate language (hreflang) information in the sitemap as well as in the page head section. The major search engines, such as <a href="https://support.google.com/webmasters/answer/2620865" title="Google international sitemap help">Google</a>, <a href="https://webmaster.yandex.ru/blog/15326" title="Yendex support for multilingual sites">Yendex</a>, and <a href="https://www.bing.com/webmasters/help/webmaster-guidelines-30fba23a" title="Bing Webmaster Guidelines">Bing</a> support both methods. <a href="https://martinkura.com/baidu-international-websites-hreflang-geographic-target-meta-language-tag/" title="Baidu only focuses on Mandarin Chinese websites">Baidu</a>, the Chinese search engine, focuses on Chinese websites, so they&rsquo;re not a concern so long as there is a Chinese site available (i.e. there are pages with the lang attribute on the html tag set to zh-CN).</p>
                    <p>x-default &ndash; I haven&rsquo;t designated one page as the x-default version as x-default appears <a href="https://moz.com/learn/seo/hreflang-tag" title="General Targeting with x-default">to be used</a> to designate a page with multiple languages or a <a href="https://productforums.google.com/forum/#!topic/webmasters/L0g73tLsHvA" title="Correct usage of hreflang=x-default">language selection page</a>.</p>
                </div>
            </div>
        </div>
    </section>

    <section id="fonts" class="bg-white">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <h2>Fonts</h2>
                    <p>I use system fonts for displaying most of the text (I use a monospaced font for code samples). System fonts are the fonts the operating system uses for displaying text, so they work well with the device and users are generally comfortable with the font. System fonts are specified by using the <a href="https://caniuse.com/font-family-system-ui" title="system-ui value for font-family is supported by most modern browsers (not IE)">system-ui</a> font-family value. There is an additional advantage in that the fonts are already present on the device, so there is no waiting for an external font to download.</p>
                    <h3>San Serif font</h3>
                    <pre><code class="css hljs">body {
    font-family: system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
}</code></pre>
                    <table class="table table-sm table-bordered ml-5 font-table">
                        <tr>
                            <th>Font</th>
                            <th>System</th>
                        </tr>
                        <tr>
                            <td>system-ui</td>
                            <td>Default system font</td>
                        </tr>
                        <tr>
                            <td>Segoe UI</td>
                            <td>Windows</td>
                        </tr>
                        <tr>
                            <td>Roboto</td>
                            <td>Android</td>
                        </tr>
                        <tr>
                            <td>Helvetica</td>
                            <td>Older Apple versions</td>
                        </tr>
                        <tr>
                            <td>Arial</td>
                            <td>Older Windows</td>
                        </tr>
                        <tr>
                            <td>sans-serif</td>
                            <td>generic fallback</td>
                        </tr>
                    </table>
                    <p></p>
                    <h3>Monospaced font</h3>
                    <pre><code class="css hljs">body {
    font-family: ui-monospace, Menlo, Monaco, "Cascadia Mono", "Segoe UI Mono",
        "Roboto Mono", "Courier New", monospace;
}</code></pre>
                    <table class="table table-sm table-bordered ml-5 font-table">
                        <tr>
                            <th>Font</th>
                            <th>System</th>
                        </tr>
                        <tr>
                            <td>ui-monospace</td>
                            <td>Default system font (Apple only)</td>
                        </tr>
                        <tr>
                            <td>Menlo</td>
                            <td>Older Apple devices</td>
                        </tr>
                        <tr>
                            <td>Monaco</td>
                            <td>Older Apple devices</td>
                        </tr>
                        <tr>
                            <td>"Cascadia Mono"</td>
                            <td>Newer Windows</td>
                        </tr>
                        <tr>
                            <td>"Segoe UI Mono"</td>
                            <td>Windows</td>
                        </tr>
                        <tr>
                            <td>"Roboto Mono"</td>
                            <td>Android</td>
                        </tr>
                        <tr>
                            <td>"Courier New"</td>
                            <td>Older Windows</td>
                        </tr>
                        <tr>
                            <td>monospace</td>
                            <td>generic fallback</td>
                        </tr>
                    </table>
                    <h3>Google Noto fonts</h3>
                    <p>I previously used Google fonts, but as an <a class="same-page-link" href="#user-tracking" title="See the section on IP address privacy for information on the EU decision">EU court</a> has ruled against sharing users&rsquo; IP addresses with third-parties (such as Google fonts), I stopped.</p>
                    <p>It is possible to self-host fonts from Google. Fonts, such as the Noto family of fonts, which includes fonts for Chinese, Japanese, and Korean (CJK) characters, are available under a <a href="https://scripts.sil.org/cms/scripts/page.php?site_id=nrsi&id=OFL" title="SIL license page">SIL International Open Font License</a>. The problem is the stylesheets. Many of the fonts have been subsetted (broken into a number of files, referenced by character Unicode values). The separate font files and the stylesheets with the unicode-range make it possible for a browser to download just the font files needed for a webpage. Those font files and stylesheets are only available from Google&rsquo;s font API (they are not included under the Open Font License).</p>
                    
                </div>
            </div>
        </div>
    </section>

    <section id="social" class="bg-white">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <h2>Social networking</h2>
                    <p>Social networking sites and apps check how a page should be referenced if someone shares a link to the page.</p>
                    <h3>Open Graph</h3>
                    <p>Most social networking apps support Open Graph:</p>
                    <ul>
                        <li>og:type &ndash; website</li>
                        <li>og:title &ndash; page title with the company name</li>
                        <li>og:description &ndash; description of the page content
                        <li>og:url &ndash; URL for the current page</li>
                        <li>og:site_name &ndash; the name of the site</li>
                        <li>og:image &ndash; image when displaying a link to this page (keeps messaging apps from grabbing the logo to use as the representative image for the site) &ndash; recommended size is 1200px by 630px, but should look good when scaled down to 250px by 128px</li>
                    </ul>
                    <h3>Twitter Card</h3>
                    <p>Twitter has their own set of tags:</p>
                    <ul>
                        <li>twitter:card &ndash; defines the type of card (Twitter has four types, <em>Summary</em>, <em>Summary with large image</em>, <em>Player card</em>, and <em>App card</em> &ndash; Summary is the best type for a business website)</li>
                        <li>twitter:description &ndash; description of the page content
                        <li>twitter:title &ndash; title for the page</li>
                        <li>twitter:image &ndash; Twitter includes a 144x144 image when displaying a tweet that references the page</li>
                        <li>twitter:site &ndash; Twitter address for the company (@twittername) &ndash; this is optional</li>
                    </ul>
                    <p>Note: I&rsquo;m using the page title and description variables (&#123;&#123; &#64;siteOwner &#125;&#125; â€“ &#123;&#123; &#64;pageTitle &#125;&#125; &amp; &#123;&#123; &#64;pageDescription &#125;&#125;) for the social network / twitter title and description. If a different title and/or description is desired, it would be easy to add separate variables to the page controller.</p>
                </div>
            </div>
        </div>
    </section>

    <section id="scroll-anchor" class="bg-white">
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 mx-auto">
                        <h2>Scroll to anchors</h2>
                        <p>For page anchors:</p>
                        <ul>
                            <li>Clicking a link for a same-page anchor triggers a 1-second scroll to the new position, rather than the page jumping to the new position (unless the user has set <code>prefers-reduced-motion</code> to <code>reduce</code>, in which case, the page will jump to the new position).</li>
                            <li>Anchors are generally assigned to sections (there&rsquo;s only one case that isn&rsquo;t). Sections are styled with 4rem padding on the top and bottom (the padding is the same so that the section content is centered vertically, which is important if the section has a background color, as is done on the home page).</li>
                            <li>The 4rem padding at the top is to clear the fixed navbar at the top of the page. When the page is first loaded, the navbar is 74px high (4.625rem). After the page has been scrolled more than 100px, a class, .small-logo is added to the navbar that reduces the size of the logo, reducing the height of the navbar to 58px (3.625rem). Reducing the size of the navbar allows the anchor text to be seen without excessively increasing the spacing between sections.<ul>
                                <li>The top sections in the detail pages have a 6rem (for mobile screens) or 7rem padding at the top to clear the full-height navbar.</li>
                                <li>In one case, the destination is <em>within</em> a section. I added the destination ID slightly above the desired text in a list item.</li>
                                <li>I tried styling the sections with a <a href="http://nicolasgallagher.com/jump-links-and-viewport-positioning/demo/#method-E" title="Based on a blog post by Nicolas Gallagher">3rem border-top and a -3rem margin-top</a>, but with that styling on Chrome, the page would jump when I set the focus to the section.</li>
                            </ul></li>
                            <li>Using a link within a page is not recorded in the browser history. Using the browser&rsquo;s back button will return to the previous page, rather than the previous position on the same page.<ul>
                                <li>It is possible to push the current address hash onto the browser&rsquo;s history, but having that capability seems to make it more confusing to navigate the site.</li>
                            </ul></li>
                            <li>After scrolling to a position on the same page, focus is set on the destination element to support <a href="https://css-tricks.com/smooth-scrolling-accessibility/" title="CSS-Tricks article on Smooth Scrolling and Accessibility">keyboard users</a>.<ul>
                                <li><em>I style the section:focus outline-color to transparent so the section won&rsquo;t have a line around it on Chrome browsers.</em></li>
                            </ul></li>
                        </ul>
                        <p><em>More information is available in the <a href="{{ @schemeHost }}/js/js-functions.js" target="_blank" title="JavaScript file - link opens in a new tab">js-functions</a> JavaScript file.</em></p>
                    </div>
                </div>
            </div>
        </section>
    

    <section id="scroll-button" class="bg-white">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <h2>Scroll-to-top button</h2>
                    <p>I looked at several scroll-to-top buttons from GitHub and other sites, but they all had one problem: the button went all the way to the bottom, <em>over the footer</em>. If the button is a similar color to the footer, the button would no longer be easy to see.</p>
                    <p>My solution is to monitor the distance from the top of the page (B) plus the height of the window (C) compared to the total height of the page (A) minus the height of the footer (D).</p>
                    <div class="row mb-4">
                        <div class="col-12 col-md-6 mb-4">
                            <picture>
                                <source srcset="../images/details-scroll-calc-dark.webp, ../images/details-scroll-calc-lg-dark.webp 2x" media="(prefers-color-scheme: dark)">
                                <source srcset="../images/details-scroll-calc.webp, ../images/details-scroll-calc-lg.webp 2x">
                                <img class="float-left mw-100 h-auto" src="../images/details-scroll-calc.png" alt="Graphic showing the calculation for when to adjust the position of the scroll-to-top button" width="365" height="425" loading="lazy">
                            </picture>
                        </div>
                        <div class="col-12 col-md-6">
                            <h3>Button position calculation</h3>
                            The button position is based on:
                            <ul>
                                <li><strong>A</strong> &ndash; Total height<ul>
                                    <li>document.document&shy;Element&shy;.scrollHeight</li>
                                    </ul></li>
                                <li><strong>B</strong> &ndash; Scroll top<ul>
                                        <li>window.pageYOffset</li>
                                    </ul></li>
                                <li><strong>C</strong> &ndash; Window height<ul>
                                    <li>window.innerHeight</li>
                                </ul></li>
                                <li><strong>D</strong> &ndash; Footer height<ul>
                                    <li>footer = doc.get&shy;Elements&shy;ByTag&shy;Name&shy;("footer")[0]</li>
                                    <li>footer.clientHeight</li>
                                </ul></li>
                            </ul>
                        </div>
                    </div>
                    <p>Normally the button is positioned near the bottom of the screen. If (B + C) &gt; (A - D), then the footer is showing and the button position is adjusted.</p>
                    <p>I monitor the distance by listening for scroll events. Scroll events are routed through a throttler function that calls the scroll handler function. The throttler function is also called by a resize event listener to adjust the button position if there&rsquo;s a change in the window height, which happens on mobile displays when the URL bar is hidden.</p>
                    <p><em>More information is available in the <a href="{{ @schemeHost }}/js/js-functions.js" target="_blank" title="JavaScript file - link opens in a new tab">js-functions</a> JavaScript file.</em></p>
                    <p>After the page is scrolled back to the top, focus is applied to the page, which enables a keyboard user to navigate the page from the beginning.</p>
                    <pre><code class="javascript hljs">doc.documentElement.tabIndex = 0;
doc.documentElement.focus();</code></pre>
                    <p>I include the tabIndex line for the documentElement as it&rsquo;s needed for <a href="https://bugs.chromium.org/p/chromium/issues/detail?id=467043" title="Chrome bug report on applying focus to the html element">Chrome</a>. Firefox and Internet Explorer don&rsquo;t require the extra step, but it doesn&rsquo;t hurt.</p>
                    <p>I use a sticky footer setup with a large bottom margin on the body that matches the height of the footer (the body margin-bottom is set using JavaScript, and is updated every time the browser is resized).</p>
                </div>
            </div>
        </div>
    </section>

    <section id="reduced-motion" class="bg-white">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <h2>Prefers reduced motion</h2>
                    <p>Prefers reduced motion is a system setting (for Windows, it is the <em>Show animations in Windows</em> setting and for Mac, it is the <em>Reduce Motion</em> setting) to aid people who are afflicted with vestibular disorders and could experience problems with animated content. When reduced motion is enabled, most <a href="https://getbootstrap.com/docs/4.6/getting-started/accessibility/#reduced-motion" title="Bootstrap accessibility features">Bootstrap</a> CSS transition effects are disabled.</p>
                    <p>For the animations controlled by jQuery functions, I set $.fx.off to true, which causes all animations to happen immediately.</p>
                    <pre><code class="javascript hljs">if (typeof window.matchMedia === 'function') {
    var motionReduce = window.matchMedia("(prefers-reduced-motion: reduce)");

    if (motionReduce.matches === true) {
        $.fx.off = true;
    }
}</code></pre>
                    <p><em>Note: Internet Explorer does not support reduced-motion.</em></p>
                </div>
            </div>
        </div>
    </section>

    <section id="dark-mode" class="bg-white">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <h2>Dark mode</h2>
                    <p>More than 80% of smartphone users, according to <a href="https://earthweb.com/how-many-people-use-dark-mode/" title="How Many People Use Dark Mode in 2022?,">one website</a>,  use dark mode, and many of those people expect websites to have a dark theme. While the percentage seems high, it is clear that sites need to consider having two modes, light and dark.</p>
                    <p>The easiest way to implement dark mode would be to use CSS custom properties (variables) on the root, but as Internet Explorer does not support CSS custom properties, I used <code>@media</code> queries in the CSS file to override the default light colors.</p>
                    <pre><code class="css hljs">body {
    color: $body-color;
    background-color: $body-bg;
}

@media (prefers-color-scheme: dark) {
    body {
        color: rgba(256,256,256,0.7);
        background-color: #121212;
    }
}</code></pre>
                    <p><strong>Bootstrap dark mode </strong> &mdash; The beta1 version of Bootstrap 5.2.0, which was released in May of 2022, supports <a href="https://deploy-preview-35857--twbs-bootstrap.netlify.app/" title="Bootstrap dark mode demo page">dark mode</a>. As version 5 does not support Internet Explorer, making the switch will depend on how many people continue to use Internet Explorer.</p>
                    <h3>Dark mode design</h3>
                    <p>I've based my dark mode design on Google&rsquo;s Material Design concept &mdash; start from a dark gray background (#121212) and use increasingly lighter shades of gray for secondary <em>surfaces</em> (e.g. dropdown menus). While Material Design suggests pure grays, I&rsquo;ve gone with a more steel-blue color (#12161a).</p>
                    <h3>Dark mode switch</h3>
                    <p>A number of websites provide a switch for users to switch between light and dark modes (with the page using local storage to remember the user&rsquo;s selection). I don&rsquo;t think a switch is needed unless a page has the potential for users to visit multiple times and the users need to interact with the page (not just read information). The user has already made their preference known (through the setting in the OS).</p>
                    <h3>Dark mode favicon</h3>
                    <p class="mb-1">Favicons are important for a website as they&rsquo;re used for identifying the site on the:</p>
                    <ul>
                        <li>Page tab</li>
                        <li>Favorites menubar &amp; dropdown</li>
                        <li>Address bar</li>
                    </ul>
                    <p>If there are more than ten or fifteen tabs open in a browser, the title in the tab becomes shorter, making the favicon the primary way to visually locate a tab.</p>
                    <p>In light mode, the color for tabs (active, idle, or hover) and for bookmark lists runs from white (#ffffff) to a light-gray (#d6d6d6). In dark mode, the colors run from #444547 to #1c1b22. Designing a favicon that works well against light <em>and</em> dark backgrounds and matches with the site branding is not easy.</p>
                    <p>The original favicon for this site was a person wearing a hardhat (in keeping with the construction theme). The hardhat was black and the person was yellow with a black outline. This works with light backgrounds, but isn&rsquo;t as good against dark backgrounds</p>
                    <p><img class="border border-medium" src="../images/Favicon-ico-background-comparison.png" width="256" height="64" alt="Original favicon on different backgrounds"></p>
                    <p>To have the icon more visible against light and dark backgrounds, I changed the outline from black (#000000) to gray (#808080) in the favicon.ico file.</p>
                    <p><img class="border border-medium" src="../images/Favicon-ico-background-comparison-gray.png" width="256" height="64" alt="Favicon using a gray outline for better visibility against dark backgrounds"></p>
                    <p>For browsers that use an SVG favicon file (i.e., modern browsers except Safari), I provide a favicon.svg file that has two versions, one with a black outline and one with a white outline for light and dark mode.</p>
                    <p><img class="border border-medium" src="../images/Favicon-ico-background-comparison-both.png" width="256" height="64" alt="SVG favicon showing better visibility against light and dark backgrounds"></p>
                    <h3>Touch icons</h3>
                    <p>I include touch icons for Apple &amp; Android mobile devices. While most users will likely not save the site to their home screen, I like having the option available (especially for company employees if it&rsquo;s a business website).</p>
                    <p><img src="../apple-touch-icon.png" width="128" height="128" alt="Example of a touch icon for use on a mobile device"></p>
                </div>
            </div>
        </div>
    </section>

    <section id="overlay-image-slider" class="bg-white">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <h2>Overlay image slider</h2>
                    <p>I wanted an image slider that could show information laid over a graphic of the site&rsquo;s structure.</p>
                    <p>I tried Bootstrap 4&rsquo;s carousel component, but I wanted the carousel to pause when the mouse was over the carousel and to resume moving once the mouse moves out (no significant delay). I looked at a number of jQuery plugins and image sliders on GitHub, but a plugin seemed like overkill and none of the sliders on GitHub had all of the features I wanted. So, I made my <a href="{{ @schemeHost }}{{ 'en_details2' | alias }}#structure" title="Overlay image slider in use for the site structure section">own slider</a> that:</p>
                    <ul>
                        <li>Uses img tags for the overlay images rather than styling the overlay images as background images</li>
                        <li>Supports text with each image</li>
                        <li>Has Previous and Next buttons</li>
                        <li>Has a current image indicator / selector</li>
                        <li>Is able to cycle the overlay images in a continuous sequence (a number of sliders will quickly reverse through all of the images after the last image to get back to the first image)</li>
                        <li>Can pause on mouse-over and <em>quickly</em> resume (500ms) when the mouse leaves (several sliders restart the full delay count before continuing to the next image)</li>
                        <li>Is responsive</li>
                    </ul>
                </div>
            </div>
        </div>
    </section>

    <section id="image-management" class="bg-white">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <h2>Image management</h2>
                    <p>To improve page loading times, JEPG and PNG image files are compressed using an online compression application (<a href="https://tinypng.com/" title="Online compression application">tinypng.com</a>). I do not run the WEBP files through the online compression site as it adds JPEG type artifacts to the image (the file may be smaller, but I don&rsquo;t like the effect). <em>I use <a href="https://www.gimp.org/" title="Free and Open Source Image Editor">GIMP</a> for graphics work, which is free, but the JPEG &amp; PNG image files do need to be compressed for use on a website.</em></p>
                    <!-- I originally used https://compresspng.com/ but iloveimg.com produces smaller files (at least for PNGs), so I switched -->
                    <p>Larger images that are used on multiple pages (e.g. the logo) are loaded as separate images. Smaller images that are used on multiple pages (e.g. the language flags) are embedded in the CSS file as <a href="http://freeonlinetools24.com/base64-image" title="Online image-to-base64 converter">Base64</a> background images.</p>
                    <p>I use the <code>loading="lazy"</code> attribute on the img tag to delay loading images that normally do not show when the page is first loaded.</p>
                    <pre><code class="html hljs">&lt;picture&gt;
    &lt;source srcset="../images/bootstrap-sass-architecture-dark.webp,
        ../images/bootstrap-sass-architecture-lg-dark.webp 2x"
        media="(prefers-color-scheme: dark)"&gt;
    &lt;source srcset="../images/bootstrap-sass-architecture.webp,
        ../images/bootstrap-sass-architecture-lg.webp 2x" &gt;
    &lt;img class="scss-diagram mb-3" src="../images/bootstrap-sass-architecture.png"
        alt="Diagram of the Sass files used to construct the site CSS"
        width="538" height="372" loading="lazy"&gt;
&lt;/picture&gt;</code></pre>

                </div>
            </div>
        </div>
    </section>

                            
    <section id="fixed-hero" class="bg-white">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <h2>Fixed hero image</h2>
                    <p>Having a large image (<em>a hero image</em>) that stays fixed while the content scrolls over it is a popular front page design.</p>
                    <p><em>A more ambitious concept is to use a parallax setup that has multiple images whose positions are controlled by translate3d, but I find those types of displays distracting for a business website.</em></p>
                    <p>The problem with a hero image is the browser displays an empty space (just the background color) while the image is loading and a large image can take a while to download. Even worse, if it&rsquo;s styled as a CSS background image (which seems to be the most common method for hero images), browsers will request it later in the load cycle, increasing the time the empty space is shown.</p>
                    <p>To reduce the delay for showing the image, I:</p>
                    <ul>
                        <li>Reduced the image file size:<ul>
                            <li><strong>Use a smaller image</strong> &ndash; sites with hero images that I looked at used a 1920px by 1080px JPEG image, which is the same size as a large monitor. To reduce the image file size, I use a 1626px by 835px image based on:<ul>
                                <li>Average the screen <em>width</em> of a 1920px wide display and a 1366px wide display (after subtracting the scrollbar) ~ (1920-17 + 1366-17) / 2 = 1626px</li>
                                <li>Average the screen <em>height</em> of a 1080px high display and a 766px high display (after subtracting for the browser tabs, url bar, &amp; bookmark bar) ~ (1080-88 + 768-88) / 2 = 835px</li>
                            </ul></li>
                            <li><strong>Lower JPEG quality</strong> &ndash; I lowered the JPEG chroma and quality settings</li>
                        </ul></li>
                    </ul>
                    <p></p>
                    <ul>
                        <li>Embedded the image in the page:<ul>
                            <li><strong>Base64</strong> &ndash; I converted the image to a base64 image and embedded the image in the page</li>
                        </ul></li>
                    </ul>
                    <p>Embedding a base64 image pretty much eliminates the flash of background color. It does make the page larger (in my case, the page, gzipped, went from 5.7kb to 70.3kb), but it eliminates downloading an image (67kb). Embedding the image does mean the image will be downloaded every time, but, since it&rsquo;s unlikely that people will visit the home page of an informational website that many times, it seems like a reasonable trade-off.</p>
                    <p>I did try preloading the image in the head section, but embedding the image was faster.</p>
                    <p>One other option I looked at was to embed a small version of the image that would load with the page. The small image would display quickly (albeit blurry), and then, when the full image was loaded, the browser would transition from the small image to the full image. While the technique (which is used on this <a href="https://mikeindustries.com/blog/" title="Mike Davidson, former VP of Design for Twitter, personal site">site</a> and the method explained on this <a href="https://www.perpetual-beta.org/weblog/silky-smooth-image-loading.html" title="Jonathan Hollin's Silky-Smooth Image Loading">site</a>) looks nice in some situations, I decided it was worth the page size penalty to get the full-size image there quickly.</p>
                    <p><em>Note: The hero image used on the demo site is used under a Creative Commons license. The image used for the <a href="https://github.com/RichDeBourke/simple-f3-multi-lang-site" title="Demo source files on GitHub">GitHub</a> files is a graphic to simulate the image, rather than the actual image.</em></p>
                </div>
            </div>
        </div>
    </section>
    
    <section id="user-tracking" class="bg-white">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <h2>Privacy and tracking users</h2>
                    <p>The European Union&rsquo;s General Data Protection Regulation (GDPR) defines how internet users&rsquo; personal data is to be handled by organizations that have European offices as well as non-European organizations that target European users for free or paid goods or services.</p>
                    <p>You should consult with your legal advisor on whether or not you need a cookie notice, a <a href="{{ @schemeHost}}{{ @langSubdirectory.'_termsx' | alias }}" title="The privacy statement for this site">privacy statement</a>, and/or a way for users to opt-out of tracking.</p>
                    <h3>IP address privacy</h3>
                    <p>In 2016, the Court of Justice of the European Union held that, in certain circumstances, <a href="https://curia.europa.eu/juris/document/document.jsf?text=&docid=184668&pageIndex=0&doclang=EN&mode=lst&dir=&occ=first&part=1&cid=1328710" title="Court judgement on InfoCuria">IP addresses are personal data</a>.</p>
                    <p>This was followed in early 2022 by a decision from a <a href="https://www.theregister.com/2022/01/31/website_fine_google_fonts_gdpr/" title="Website fined by German court for leaking visitor's IP address via Google Fonts">court in Munich</a> that linking to a third-party without prior consent, such as to Google to use Google fonts, violated the EU privacy law.</p>
                    <p>Based on the prohibition against sharing a user&rsquo;s IP address, I have:</p>
                    <ul>
                        <li>switched from using Google fonts to using system fonts;</li>
                        <li>switched from sourcing framework and library files (i.e. Bootstrap and jQuery javascript) from content delivery networks (i.e. cdnjs) to self-hosting the files;</li>
                        <li>and switched to downloading the JavaScript file for Google Analytics only if the user has agreed to accept tracking cookies.</li>
                    </ul>
                    <h3>Google analytics</h3>
                    <p>I use <a href="https://analytics.google.com/analytics/web/" title="Google Analytics homepage">Google Analytics</a> (along with <a href="https://search.google.com/search-console/about" title="What used to be Google Webmaster Tools and is now Google Search Console">Google Search Console</a>) to understand how my sites are being used. Previously, to enable users to opt-out of their data being sent to Google, I used Google&rsquo;s <a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/user-opt-out" title="Google Analytics User Opt-out">ga-disable cookie</a> method, <em>but</em> that method still required the browser to download a JavaScript file <em>from</em> Google to read the cookie that said whether the user had opted out or not. The browser was still sending the user&rsquo;s IP address to Google in order to get the JavaScript file.</p>
                    <p>I switched from using Google&rsquo;s ga-disable cookie method to using either my own cookie or a sessionStorage value. When someone visits the site for the first time, they are presented with a cookie notice where they can either accept cookies (and allow the use of Google Analytics) or they can opt-out.</p>
                    <p>If the visitor accepts the use of cookies (and the use of Google Analytics), I create a cookie, valid for one year, to record their choice. After that, when they visit the site, the page reads the cookie and does not display the cookie notice.</p>
                    <p>If  the visitor rejects the use of cookies (and the use of Google Analytics), I store a value in sessionStorage to record their choice. After that, when the visitor views any other site page during the current browser session (the browser and the tab remain open), the pages will read the sessionStorage value and not display the cookie notice. If the visitor returns to the site in a different session, they will again be shown the cookie notice.</p>
                    <p>To make this work, I use three JavaScript code components to manage user tracking. The first is in the head section of the page:</p>
                    <pre><code class="php hljs">var gaScript;
var googleAnalyticsID = "UA-11155712-3";
gaScript = document.createElement("script");
gaScript.async = true;
gaScript.src = "https://www.googletagmanager.com/gtag/js?id=UA-11155712-3";

// Until Google Tagmanager has been loaded, this code will have no effect
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-11155712-3', { "anonymize_ip": true });

if (document.cookie.indexOf("eu-cookie-notice=true") > -1) {
    // User has accepted the terms, so load analytics (not opted out).
    document.head.appendChild(gaScript);
}</code></pre>
                    <p>This code creates a script tag to load the Google Tag Manager JavaScript, and, if the user has previously accepted cookies, the script tag is appended to the page head. This code also sets up a dataLayer array for Google tag information. If the user has or does accept cookies, the tracking information will be sent to Google. If the user rejects tracking, the Google JavaScript will not be downloaded and the tracking information will never be sent.</p>
                    <p>The second component is in the <a href="{{ @schemeHost }}/js/js-functions.js" target="_blank" title="JavaScript file - link opens in a new tab">js-functions</a> file and handles the cookie notice:</p>
                    <pre><code class="php hljs">// Show the EU cookie notice (if it's the first time to the site or a new session)
if (document.cookie.indexOf("eu-cookie-notice") &lt; 0) { // no cookie
    if (window.sessionStorage.getItem("eu-opt-out") !== "true") { //no session item
        //Cookie not found and no current session, so show the banner
        $("#eu-cookie").slideDown();
        $(".detail-first-section").addClass("cookie-notice-margin");
        $("#btn-cookie-accept").on("click", function() {
            var date = new Date();
            // gaScript is defined in the head
            date.setTime(date.getTime() + 31536000000); // one year
            document.cookie = "eu-cookie-notice=true; expires=" 
                + date.toGMTString() + ";path=/";
            $("#eu-cookie").slideUp();
            $(".detail-first-section").removeClass("cookie-notice-margin");
            
            // Enable tracking
            document.head.appendChild(gaScript);
        });
        $("#btn-cookie-opt-out").on("click", function() {
            try {
                window.sessionStorage.setItem("eu-opt-out", "true");
            } catch (error) {
                console.error(error);
            }
            $("#eu-cookie").slideUp();
            $(".detail-first-section").removeClass("cookie-notice-margin");
        });
    }
}</code></pre>
                    <p>This code checks whether a visitor is new to the site, and if so, shows a banner across the top of the page with information about the site using cookies, with one button for the user to accept cookies and another for the user to opt-out of tracking.</p>
                    <p>Accepting cookies stores a cookie that the user has accepted, hides the notice, and triggers Google tracking for this visit. The cookie is good for one year, after which the user will need to reaccept cookies.</p>
                    <p>Opting out of cookies stores a session variable that the user has opted out and hides the notice.</p>
                    <p>The notice includes a link to the <a href="{{ @schemeHost}}{{ @langSubdirectory.'_termsx' | alias }}" title="The privacy statement for this site">Terms of Use</a> page, which includes privacy information and its own opt-out button. This is the third JavaScript component:</p>
                    <pre><code class="php hljs">&lt;button type="button" class="btn btn-dark center opt-out" onclick="gaOptOut()"&gt;
    Opt-out of Cookies &amp; Analytics&lt;/button&gt;
               
function gaOptOut() {
    try {
        window.sessionStorage.setItem("eu-opt-out", "true");
    } catch (error) {
        console.error(error);
    }
    document.cookie = "eu-cookie-notice=; expires=Thu, 01 Jan 1970 00:00:01 GMT;
        path=/";
    $("#eu-cookie").slideUp();
    $(".detail-first-section").removeClass("cookie-notice-margin");
}</code></pre>
                    <p>The opt-out button stores a session variable that the user has opted out. If the cookie notice is visible, it is hidden, and if there was a cookie, it is removed.</p>
                    <p>The head template includes code to conditionally load a polyfill for the string.trim JavaScript function. IE 8 and older versions of Internet Explorer don&rsquo;t support the trim function, which is needed for the Google tag manager. Loading the polyfill prevents any errors.</p>
                <pre><code class="javascript hljs">&lt;script&gt;
// Polyfill for old Internet Explorers
if (!String.prototype.trim) {
    String.prototype.trim = function () {
        return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g, &apos;&apos;);
    };
}
&lt;/script&gt;</code></pre>
                </div>
            </div>
        </div>
    </section>
    
    <section id="error-pages" class="bg-white">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <h2>Error response pages</h2>
                    <p>I created custom error pages for <a href="{{ @schemeHost }}/404" title="Page not found page" rel="nofollow">404 Page not found</a> and <a href="{{ @schemeHost }}/error" title="Error page" rel="nofollow">500 server errors</a> that fit with the theme of the site.</p>
                    <p><em>And just for fun, the 404 page includes an animation while the error page includes scrolling text (as in &ldquo;I&rsquo;m busy checking the code at that very moment.&rdquo;)</em></p>
                </div>
            </div>
        </div>
    </section>
    
    <section id="highlighter" class="bg-white">
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 mx-auto">
                        <h2>Syntax highlighter</h2>
                        <p>I&rsquo;m using <a href="https://highlightjs.org/" title="Syntax highlighting for the Web">highlight.js</a> to highlight the code examples. Highlight.js&rsquo;s <a href="https://highlightjs.org/download/" title="Highlight.js download page">download page</a> builds a JavaScript file specific to the types of code to be highlighted, and includes all of the available CSS files in the download file (I went with the GitHub style with a few changes).</p>
                        <p><em>Note: I use highlight.js Version 9 as that version is compatible with Internet Explorer 9, 10, &amp; 11. Newer versions of highlight.js work only with modern browsers.</em></p>
                        <p>The class names for the code types that I included in my build are:</p>
                        <ul>
                            <li>php</li>
                            <li>apache</li>
                            <li>http</li>
                            <li>ini</li>
                            <li>css</li>
                            <li>xml</li>
                            <li>javascript</li>
                        </ul>
                        <p>I did convert the Highlight.js css file to Sass so I could include it in the CSS file for the site.</p>
                    </div>
                </div>
            </div>
        </section>
    
    <section id="language-flags" class="bg-white">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <h2>Language flags</h2>
                    <p>The websites I work with need two or more languages (at least English and Korean), which means a language switcher, and I wanted an indication near the top of the page that other languages are available (instead of in the footer).</p>
                    <p>The easiest way to indicate the current language is to display a country flag (but be careful about implying that Taiwan or Hong Kong are countries). The source I use for flags is <a href="https://github.com/gosquared/flags" title="GitHub page for GoSquare">GoSquare&rsquo;s Flag Icon Set GitHub site</a>. GoSquare makes a complete set of flags available under the MIT license.</p>
                    <p>I compressed the PNG files and converted them to Base64 so the images can be embedded in the CSS file as background images.</p>
                </div>
            </div>
        </div>
    </section>

    <section id="firefox" class="bg-white">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <h2>Firefox flashs of unstyled content</h2>
                    <p>I use the Firefox browser as I like its separate search bar. Firefox was showing a <em>flash of unstyled content (FOUC)</em> if I loaded the page with an empty cache. To fix the problem, I applied the hack from this <a href="https://stackoverflow.com/a/64158043/1011984">Stackoverflow answer</a> at the end of the head section to resolve the issue:</p>
                    <pre><code class="css hljs">&lt;script&gt;
    /*to prevent Firefox FOUC*/
    var FF_FOUC_FIX;
&lt;/script&gt;</code></pre>
                    <p>Firefox was also displaying the alt text for the logo when the page was loaded for the first time (again, an empty cache). I fixed that by setting the text color to transparent:</p>
                    <pre><code class="css hljs">.navbar-brand img {
    color: transparent;
}</code></pre>
                </div>
            </div>
        </div>
    </section>
